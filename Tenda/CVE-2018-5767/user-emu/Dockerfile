FROM firmianay/qemu-user-static
LABEL Author="firmianay@gmail.com"

WORKDIR /root

# 复制固件
COPY ./firmware/_*/squashfs-root /root/squashfs-root

# 复制工具
COPY ./user-emu/tools /root/tools

RUN apt-get update && apt-get install -y --no-install-recommends uml-utilities bridge-utils isc-dhcp-client net-tools \
    && mv /usr/bin/qemu-arm-static ./squashfs-root \
    && /bin/bash -c ./tools/patch.sh \
    && rm -rf /var/lib/apt/lists/* \
    mv /sbin/dhclient /usr/sbin/dhclient

COPY ./user-emu/run.sh /root/run.sh
CMD [ "/bin/sh", "-c", "./run.sh" ]
