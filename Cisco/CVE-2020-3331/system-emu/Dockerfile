FROM firmianay/qemu-system:mipsel
LABEL Author="g0g0den4@gmail.com"

WORKDIR /root

# 复制固件
COPY ./firmware/rootfs.tar.gz /root/rootfs.tar.gz

RUN apt-get update && apt-get install -y --no-install-recommends uml-utilities bridge-utils isc-dhcp-client net-tools wget gawk vim\
    && tar zxvf rootfs.tar.gz 

RUN wget https://people.debian.org/~aurel32/qemu/mipsel/debian_wheezy_mipsel_standard.qcow2 -O /root/images/debian_wheezy_mipsel_standard.qcow2
RUN wget https://people.debian.org/~aurel32/qemu/mipsel/vmlinux-3.2.0-4-4kc-malta -O /root/images/vmlinux-3.2.0-4-4kc-malta
RUN python -m pip install --upgrade pwntools
RUN echo "GatewayPorts yes" >>  /etc/ssh/sshd_config

# 复制工具
COPY ./system-emu/tools /root/tools
COPY ./system-emu/run.sh /root/run.sh

CMD [ "/bin/sh", "-c", "./run.sh" ]

